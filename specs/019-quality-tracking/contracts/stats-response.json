{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Nexus Stats Response with Quality Metrics",
  "description": "Extended /v1/stats endpoint response including per-backend quality metrics",
  "type": "object",
  "required": ["uptime_seconds", "total_requests", "backends", "models"],
  "properties": {
    "uptime_seconds": {
      "type": "integer",
      "description": "Server uptime in seconds",
      "minimum": 0
    },
    "total_requests": {
      "type": "integer",
      "description": "Total number of requests processed since startup",
      "minimum": 0
    },
    "backends": {
      "type": "array",
      "description": "Per-backend statistics including quality metrics",
      "items": {
        "$ref": "#/definitions/BackendStats"
      }
    },
    "models": {
      "type": "array",
      "description": "Per-model statistics",
      "items": {
        "$ref": "#/definitions/ModelStats"
      }
    },
    "budget": {
      "type": "object",
      "description": "Budget statistics (if budget tracking is enabled)",
      "$ref": "#/definitions/BudgetStats"
    }
  },
  "definitions": {
    "BackendStats": {
      "type": "object",
      "required": ["id", "type", "status", "request_count"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique backend identifier"
        },
        "type": {
          "type": "string",
          "enum": ["ollama", "openai", "anthropic", "google", "lmstudio", "vllm"],
          "description": "Backend type"
        },
        "status": {
          "type": "string",
          "enum": ["healthy", "unhealthy", "unknown"],
          "description": "Current health status"
        },
        "request_count": {
          "type": "integer",
          "description": "Total requests routed to this backend since startup",
          "minimum": 0
        },
        "avg_latency_ms": {
          "type": "integer",
          "description": "Average request latency in milliseconds",
          "minimum": 0
        },
        "quality": {
          "type": "object",
          "description": "Quality metrics for this backend (null if no data)",
          "$ref": "#/definitions/QualityMetrics"
        }
      }
    },
    "QualityMetrics": {
      "type": "object",
      "description": "Rolling-window quality metrics for a backend",
      "properties": {
        "error_rate_1h": {
          "type": "number",
          "description": "Error rate over the last 1 hour (0.0 = no errors, 1.0 = all failed)",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "success_rate_24h": {
          "type": "number",
          "description": "Success rate over the last 24 hours (0.0 = all failed, 1.0 = all succeeded)",
          "minimum": 0.0,
          "maximum": 1.0
        },
        "avg_ttft_ms": {
          "type": "integer",
          "description": "Average time-to-first-token in milliseconds",
          "minimum": 0
        },
        "request_count_1h": {
          "type": "integer",
          "description": "Total requests processed in the last 1 hour",
          "minimum": 0
        },
        "last_failure_time": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "ISO 8601 timestamp of the most recent failure (null if no failures)"
        }
      }
    },
    "ModelStats": {
      "type": "object",
      "required": ["name", "request_count", "backends"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Model name"
        },
        "request_count": {
          "type": "integer",
          "description": "Total requests for this model",
          "minimum": 0
        },
        "backends": {
          "type": "array",
          "description": "List of backend IDs serving this model",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "BudgetStats": {
      "type": "object",
      "description": "Budget tracking statistics (optional feature)",
      "properties": {
        "daily_spend": {
          "type": "number",
          "description": "Total spend today in USD",
          "minimum": 0
        },
        "daily_limit": {
          "type": "number",
          "description": "Daily budget limit in USD",
          "minimum": 0
        },
        "remaining": {
          "type": "number",
          "description": "Remaining budget in USD",
          "minimum": 0
        }
      }
    }
  },
  "examples": [
    {
      "uptime_seconds": 3600,
      "total_requests": 1500,
      "backends": [
        {
          "id": "ollama_local",
          "type": "ollama",
          "status": "healthy",
          "request_count": 1200,
          "avg_latency_ms": 450,
          "quality": {
            "error_rate_1h": 0.05,
            "success_rate_24h": 0.98,
            "avg_ttft_ms": 250,
            "request_count_1h": 120,
            "last_failure_time": "2025-01-24T15:32:10Z"
          }
        },
        {
          "id": "openai_cloud",
          "type": "openai",
          "status": "healthy",
          "request_count": 300,
          "avg_latency_ms": 850,
          "quality": {
            "error_rate_1h": 0.02,
            "success_rate_24h": 0.99,
            "avg_ttft_ms": 180,
            "request_count_1h": 30,
            "last_failure_time": null
          }
        }
      ],
      "models": [
        {
          "name": "llama3:8b",
          "request_count": 1200,
          "backends": ["ollama_local"]
        },
        {
          "name": "gpt-4o",
          "request_count": 300,
          "backends": ["openai_cloud"]
        }
      ],
      "budget": {
        "daily_spend": 12.50,
        "daily_limit": 50.00,
        "remaining": 37.50
      }
    }
  ]
}
